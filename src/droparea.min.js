/**!
 * Droparea - Makes an easy and intuitive to upload upload files through drag and drop or select methods.
 * Copyright (c) 2015, Rogério Taques.
 *
 * @requires jQuery v1.11 or above
 * @version 1.0.6
 * @cat Plugins/Image
 * @author Rogério Taques (rogerio.taques@gmail.com)
 * @see https://github.com/rogeriotaques/droparea
 */

!function(e){"use strict";var t={url:"path/to/server/script",upload:!0,file_holder:"#file",file_preview:"#file_preview",notification_delay:5e3,accepted:".jpg|.png|.gif",file_max_size:2048,extra_data:[],success:null,i18n:{unable_to_upload:"Unable to upload at this time.<br >Select a file.",wrong_file_type:"Unacceptable file type!<br >Try: %s",wrong_file_size:"Dropped file is too big!<br >Max file size allowed: %s",abort:"Abort",mb:" MB",kb:" KB",percent:"% ",dismiss:"Dismiss",error:"Err: "}},a={init:function(a){return this.each(function(){var i=e(this),o=null,l=null,d=null,p={};p=e.extend({},t,a),e(p.file_holder).length&&e(p.file_preview).length&&e(p.file_holder).on("change",function(t){var a=new FileReader;a.readAsDataURL(e(this)[0].files[0]),a.onload=function(t){e(p.file_preview).animate({opacity:0},"slow",function(){e(this).attr("src",t.target.result).animate({opacity:1},"slow"),i.find(".statusbar.alert-block").fadeOut("slow",function(){e(this).remove()})})}}),i.parent().css("position",i.parent().css("position")),i.on("click",function(t){t.stopPropagation(),t.preventDefault(),e(p.file_holder).click()}).on("dragenter",function(e){e.stopPropagation(),e.preventDefault(),i.addClass("droparea-dragging")}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),i.removeClass("droparea-dragging")}).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),i.addClass("droparea-dragging")}).on("drop",function(t){if(t.preventDefault(),i.toggleClass("droparea-dropped droparea-dragging"),o=t.originalEvent.dataTransfer.files[0],!p.upload)return r(p,i,p.i18n.unable_to_upload,!0,!1),void e(p.file_holder).click();if(null!==p.accepted&&"boolean"!=typeof p.accepted&&p.accepted.indexOf(o.name.substr(o.name.lastIndexOf(".")).toLowerCase())===-1)return void r(p,i,p.i18n.wrong_file_type.replace("%s","<b >"+p.accepted.split("|").join("</b> or <b >")+"</b>"));if(o.size/1024>p.file_max_size)return void r(p,i,p.i18n.wrong_file_size.replace("%s","<b >"+p.file_max_size+" "+p.i18n.kb+"</b>"));if(l=new FormData,l.append(p.file_holder.replace("#",""),o),null!==p.extra_data)for(var a in p.extra_data)e("#"+p.extra_data[a].replace("#","")).length&&l.append(p.extra_data[a].replace("#",""),e("#"+p.extra_data[a].replace("#","")).val());d=new s(i,p),d.setFileNameSize(o.name,o.size),n(l,d,i,o,p)})})}},i=0,s=function(t,a){i++,this.statusbar=e('<div class="statusbar statusbar-'+i+'"></div>'),this.filename=e('<div class="filename"></div>').appendTo(this.statusbar),this.size=e('<div class="filesize"></div>').appendTo(this.statusbar),this.progressBar=e('<div class="progressbar"><div></div></div>').appendTo(this.statusbar),this.progressBarWidth=0,this.abort=e('<a class="btn abort">'+a.i18n.abort+"</div>").appendTo(this.statusbar),this.statusbar.css({width:t.outerWidth(),height:t.outerHeight(),top:t.offset().top,left:t.offset().left}),t.append(this.statusbar),this.setFileNameSize=function(e,t){var i="",s=t/1024;i=parseInt(s)>1024?(s/1024).toFixed(2)+a.i18n.mb:s.toFixed(2)+a.i18n.kb,this.filename.html(e),this.size.html(i)},this.setProgress=function(e){this.progressBarWidth=e*this.progressBar.width()/100,this.progressBar.find("div").animate({width:this.progressBarWidth},10).html(e+a.i18n.percent),parseInt(e)>=100&&this.abort.hide()},this.setAbort=function(e){this.abort.on("click",function(t){t.preventDefault(),e.abort(),this.statusbar.hide()})}},r=function(t,a,i,s,r){s="undefined"==typeof s||s,r="undefined"==typeof r||r;var n=e('<div class="statusbar alert-block"></div>'),o=(e('<div class="filename"></div>').html(i).appendTo(n),e('<button class="btn dismiss"></button>').html(t.i18n.dismiss));n.css({width:a.outerWidth(),height:a.outerHeight(),top:a.offset().top,left:a.offset().left}),a.append(n),s&&o.on("click",function(t){t.stopPropagation(),t.preventDefault(),n.fadeOut("fast",function(){e(this).remove()})}).appendTo(n),r&&setTimeout(function(){n.fadeOut("fast",function(){e(this).remove()})},t.notification_delay)},n=function(t,a,i,s,r){var n=e.ajax({xhr:function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(e){var t=0,i=e.loaded||e.position,s=e.total;e.lengthComputable&&(t=Math.ceil(i/s*100)),a.setProgress(t)},!1),t},url:r.url,type:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(t){t=e.parseJSON(t),a.setProgress(100),null!==r.success&&e.isFunction(r.success)&&r.success(t,"undefined"!=typeof t.file_name?t.file_name:null,s),i.removeClass("droparea-dropped")},error:function(e,t,i){a.progressBar.addClass("droparea-fail"),a.progressBar.find("div:first").html(r.i18n.error+i)},complete:function(t,i){setTimeout(function(){a.statusbar.fadeOut("fast",function(){e(this).remove()})},r.notification_delay)}});a.setAbort(n)};e.fn.droparea=function(t){return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.droparea()"):a.init.apply(this,arguments)}}(jQuery);
